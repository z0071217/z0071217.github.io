<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>写新日记</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>body{background:#111;color:#eee;font-family:monospace}</style>
</head>
<body class="p-4">
<h1 class="text-2xl mb-4">写 新 日 记</h1>
<form id="form" class="space-y-4 max-w-xl">
  <input id="date" type="datetime-local" class="bg-gray-800 px-3 py-1 rounded w-full" required>
  <select id="who" class="bg-gray-800 px-3 py-1 rounded w-full">
    <option>小猫 🐱</option><option>小狗 🐶</option><option>小熊 🐻</option>
  </select>
  <textarea id="text" rows="4" placeholder="内容（支持 Markdown 后期会渲染）" class="bg-gray-800 px-3 py-1 rounded w-full" required></textarea>
  <input id="img" type="url" placeholder="图片 URL（可选）" class="bg-gray-800 px-3 py-1 rounded w-full">
  <button type="submit" class="bg-cyan-600 px-4 py-2 rounded">发射 ✨</button>
</form>
<a href="index.html" class="inline-block mt-6 text-cyan-400">← 返回首页</a>

<script>
const TOKEN = '';   // 后面用代理方式，这里留空
const REPO  = 'z0071217/z0071217.github.io';

async function postIssue({title, body}){
  const res = await fetch(`https://api.github.com/repos/${REPO}/issues`,{
    method:'POST',
    headers:{
      'Accept':'application/vnd.github+json',
      'Authorization':'Bearer '+TOKEN,
      'Content-Type':'application/json'
    },
    body:JSON.stringify({title, body, labels:['diary']})
  });
  if(!res.ok) throw new Error(await res.text());
  return res.json();
}

document.getElementById('form').addEventListener('submit',async e=>{
  e.preventDefault();
  const who  = document.getElementById('who').value;
  const when = document.getElementById('date').value;
  const text = document.getElementById('text').value;
  const img  = document.getElementById('img').value;
  if(!who||!when||!text){ alert('请完整填写'); return; }

  const title = `${when} · ${who}`;
  const body  = `**作者：** ${who}\n**时间：** ${when}\n**内容：**\n${text}${img?'\n![]('+img+')':''}`;
  try{
    await postIssue({title, body});
    alert('已发布到云端！');
    location.href = 'index.html';
  }catch(err){ alert('发布失败：'+err); }
});

// 默认填此刻
document.getElementById('date').value = new Date().toISOString().slice(0,16);
</script>
</body>
</html>



<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å†™æ–°æ—¥è®°</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>body{background:#111;color:#eee;font-family:monospace}</style>
</head>
<body class="p-4">
<h1 class="text-2xl mb-4">å†™ æ–° æ—¥ è®°</h1>
<form id="form" class="space-y-4 max-w-xl">
  <input id="date" type="datetime-local" class="bg-gray-800 px-3 py-1 rounded w-full" required>
  <select id="who" class="bg-gray-800 px-3 py-1 rounded w-full">
    <option>å°çŒ« ğŸ±</option><option>å°ç‹— ğŸ¶</option><option>å°ç†Š ğŸ»</option>
  </select>
  <textarea id="text" rows="4" placeholder="å†…å®¹ï¼ˆæ”¯æŒ Markdown åæœŸä¼šæ¸²æŸ“ï¼‰" class="bg-gray-800 px-3 py-1 rounded w-full" required></textarea>
  <input id="img" type="url" placeholder="å›¾ç‰‡ URLï¼ˆå¯é€‰ï¼‰" class="bg-gray-800 px-3 py-1 rounded w-full">
  <button type="submit" class="bg-cyan-600 px-4 py-2 rounded">å‘å°„ âœ¨</button>
</form>
<a href="index.html" class="inline-block mt-6 text-cyan-400">â† è¿”å›é¦–é¡µ</a>

<script>
const REPO = 'z0071217/z0071217.github.io';

async function postIssueProxy({title, body}){
  // è°ƒç”¨ GitHub Actions APIï¼ˆå…¬å¼€å¯è¯»ï¼Œæ— éœ€ä»¤ç‰Œï¼‰
  const res = await fetch(`https://api.github.com/repos/${REPO}/actions/workflows/new-issue.yml/dispatches`,{
    method:'POST',
    headers:{
      'Accept':'application/vnd.github+json',
      'Content-Type':'application/json'
    },
    body:JSON.stringify({
      ref:'main',
      inputs:{ title, body }
    })
  });
  if(res.status !== 204) throw new Error('è§¦å‘å¤±è´¥');
}

document.getElementById('form').addEventListener('submit',async e=>{
  e.preventDefault();
  const who  = document.getElementById('who').value;
  const when = document.getElementById('date').value;
  const text = document.getElementById('text').value;
  const img  = document.getElementById('img').value;
  if(!who||!when||!text){ alert('è¯·å®Œæ•´å¡«å†™'); return; }

  const title = `${when} Â· ${who}`;
  const body  = `**ä½œè€…ï¼š** ${who}\n**æ—¶é—´ï¼š** ${when}\n**å†…å®¹ï¼š**\n${text}${img?'\n![]('+img+')':''}`;
  try{
    await postIssueProxy({title, body});
    alert('å·²å‘å¸ƒåˆ°äº‘ç«¯ï¼');
    location.href = 'index.html';
  }catch(err){ alert('å‘å¸ƒå¤±è´¥ï¼š'+err); }
});

// é»˜è®¤å¡«æ­¤åˆ»
document.getElementById('date').value = new Date().toISOString().slice(0,16);
</script>
</body>
</html>



